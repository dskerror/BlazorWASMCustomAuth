@page "/admin/roleviewedit/{id:int}"

<MudBreadcrumbs Items="_breadcrumbs"></MudBreadcrumbs>

@if (!_loadedPermissionData)
{
    <h3>Loading...</h3>
}
else
{
    if (_EditMode)
    {
        <EditForm Model="role" OnValidSubmit="EditRole">
            <DataAnnotationsValidator />
            <ValidationSummary />
            <MudCard Class="mb-2">
                <MudCardContent>
                    <MudTextField ReadOnly="true" Label="RoleName" @bind-Value="role.RoleName"
                          For="@(()=>role.RoleName)">
                    </MudTextField>
                    <MudTextField Label="RoleDescription" @bind-Value="role.RoleDescription"
                          For="@(()=>role.RoleDescription)">
                    </MudTextField>
                </MudCardContent>
            </MudCard>
            <MudButton Color="Color.Primary" ButtonType="ButtonType.Submit" Variant="Variant.Filled" Class="mb-2">Save</MudButton>
            <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="CancelChanges" Class="mb-2">Cancel</MudButton>
        </EditForm>
    }
    else
    {
        <EditForm Model="role">
            <MudCard Class="mb-2">
                <MudCardContent>
                    <MudTextField ReadOnly="true" Label="RoleName" @bind-Value="role.RoleName"
                          For="@(()=>role.RoleName)">
                    </MudTextField>
                    <MudTextField ReadOnly="true" Label="RoleDescription" @bind-Value="role.RoleDescription"
                          For="@(()=>role.RoleDescription)">
                    </MudTextField>
                </MudCardContent>
            </MudCard>
            <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="EnableEditMode" Class="mb-2">Edit</MudButton>
        </EditForm>


        <MudTable Items="@rolePermissions" Hover="true">
            <HeaderContent>
                <MudTh>On/Off</MudTh>
                <MudTh>Permission Name</MudTh>
                <MudTh>Permission Description</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="PermissionSwitch">                    
                    <MudSwitch Color="Color.Success" @bind-Checked="@context.Allow" @oninput="(e)=>ToggleSwitch(e,context.Id)" />
                </MudTd>
                <MudTd DataLabel="PermissionName">@context.PermissionName</MudTd>
                <MudTd DataLabel="PermissionDescription">@context.PermissionDescription</MudTd>
            </RowTemplate>
            <PagerContent>
                <MudTablePager PageSizeOptions="new int[]{50, 100}" />
            </PagerContent>
        </MudTable>
    }
}